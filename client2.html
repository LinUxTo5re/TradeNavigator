<!DOCTYPE html>
<html>
<head>
    <title>SignalR WebSocket Client</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
</head>
<body>
    <h2>SignalR WebSocket Client</h2>

    <button onclick="connect()">Connect</button>
    <button onclick="subscribe()">Subscribe</button>
    <button onclick="unsubscribe()">Unsubscribe</button>

    <pre id="log"></pre>

    <script>
        let connection;
        const groupName = "CandlestickGroupWS"; // must match backend group used in broadcasting

        function log(message) {
            document.getElementById("log").textContent += message + "\n";
        }

        async function connect() {
            connection = new signalR.HubConnectionBuilder()
                .withUrl("https://localhost:7001/hub/ws/gate-candlesticks") // replace port if different
                .configureLogging(signalR.LogLevel.Information)
                .build();

            connection.on("ReceiveCandlestickDataWS", message => {
                log("Received: " + JSON.stringify(message, null, 2));
            });

            try {
                await connection.start();
                log("Connected to SignalR Hub " + groupName);
            } catch (err) {
                console.error(err);
                log("Connection failed: " + err.toString());
            }
        }

        async function subscribe() {
            const message = {
    "time" : 123456, "channel" : "futures.candlesticks",
    "event": "subscribe", "payload" : ["1m", "BTC_USDT"],
    "contract": "BTC_USDT", "timeframe": "1m"
};
            try {
                await connection.invoke("Subscribe", JSON.stringify(message), groupName);
                log("Subscribed to group: " + groupName);
            } catch (err) {
                console.error(err);
                log("Subscribe failed: " + err.toString());
            }
        }

        async function unsubscribe() {
            try {
                await connection.invoke("Unsubscribe", groupName);
                log("Unsubscribed from group: " + groupName);
            } catch (err) {
                console.error(err);
                log("Unsubscribe failed: " + err.toString());
            }
        }
    </script>
</body>
</html>

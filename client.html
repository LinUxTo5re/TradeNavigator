<!DOCTYPE html>
<html>
<head>
    <title>SignalR WebSocket Client</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
</head>
<body>
    <h2>SignalR WebSocket Client</h2>

    <button onclick="connect()">Connect</button>
    <button onclick="subscribe()">Subscribe</button>
    <button onclick="unsubscribe()">Unsubscribe</button>

    <pre id="log"></pre>

    <script>
        let connection;
        const groupName = "BreakoutStrategyGroup"; // must match backend group used in broadcasting

        function log(message) {
            document.getElementById("log").textContent += message + "\n";
        }

        async function connect() {
            connection = new signalR.HubConnectionBuilder()
                .withUrl("https://localhost:7001/hub/strategy/breakoutstrategy") // replace port if different
                .configureLogging(signalR.LogLevel.Information)
                .build();

            connection.on("ReceiveBreakoutStrategy", message => {
                log("Received: " + message);
            });

            try {
                await connection.start();
                log("Connected to SignalR Hub " + groupName);
            } catch (err) {
                console.error(err);
                log("Connection failed: " + err.toString());
            }
        }

        async function subscribe() {
            const message = {
                "ThresholdPercent": 2.5,
                "SlidingWindow": 20,
                "PriceSource": "Close",
                "VolumeConfirmationRequired": true,
                "VolumeMultiplier": 1.5,
                "GroupName": "BreakoutStrategyGroup"
              };              

            try {
                await connection.invoke("Subscribe", message);
                log("Subscribed via group: " + groupName);
            } catch (err) {
                console.error(err);
                log("Subscribe failed: " + err.toString());
            }
        }

        async function unsubscribe() {
            try {
                await connection.invoke("Unsubscribe", groupName);
                log("Unsubscribed from group: " + groupName);
            } catch (err) {
                console.error(err);
                log("Unsubscribe failed: " + err.toString());
            }
        }
    </script>
</body>
</html>
